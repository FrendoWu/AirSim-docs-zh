<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>为AirSim配置PX4 - AirSim中文文档</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u4e3aAirSim\u914d\u7f6ePX4";
    var mkdocs_page_input_path = "px4_setup.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> AirSim中文文档</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">主页</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">搭建AirSim</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../use_precompiled/">下载场景文件</a>
                </li>
                <li class="">
                    
    <a class="" href="../build_windows/">在Windows上构建</a>
                </li>
                <li class="">
                    
    <a class="" href="../build_linux/">在Linux上构建</a>
                </li>
                <li class="">
                    
    <a class="" href="../unreal_custenv/">创建自定义环境</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">运行AirSim</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../apis/">核心APIs</a>
                </li>
                <li class="">
                    
    <a class="" href="../image_apis/">图像相关APIs</a>
                </li>
                <li class="">
                    
    <a class="" href="../apis_cpp/">C++ APIs</a>
                </li>
                <li class="">
                    
    <a class="" href="../dev_workflow/">开发工作流程</a>
                </li>
                <li class="">
                    
    <a class="" href="../settings/">设置</a>
                </li>
                <li class="">
                    
    <a class="" href="../camera_views/">相机视图</a>
                </li>
                <li class="">
                    
    <a class="" href="../using_car/">汽车相关</a>
                </li>
                <li class="">
                    
    <a class="" href="../remote_control/">遥控器控制</a>
                </li>
                <li class="">
                    
    <a class="" href="../xbox_controller/">XBox控制</a>
                </li>
                <li class="">
                    
    <a class="" href="../steering_wheel_installation/">方向盘控制</a>
                </li>
                <li class="">
                    
    <a class="" href="../multi_vehicle/">多车模式</a>
                </li>
                <li class="">
                    
    <a class="" href="../sensors/">传感器</a>
                </li>
                <li class="">
                    
    <a class="" href="../lidar/">LIDAR</a>
                </li>
                <li class="">
                    
    <a class="" href="../ros/">ROS</a>
                </li>
                <li class="">
                    
    <a class="" href="../playback/">运行日志</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">总体设计</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../design/">架构</a>
                </li>
                <li class="">
                    
    <a class="" href="../code_structure/">代码结构</a>
                </li>
                <li class="">
                    
    <a class="" href="../coding_guidelines/">编码指引</a>
                </li>
                <li class="">
                    
    <a class="" href="../flight_controller/">飞行控制器</a>
                </li>
                <li class="">
                    
    <a class="" href="../simple_flight/">简单的飞行</a>
                </li>
                <li class="">
                    
    <a class="" href="../hello_drone/">无人机之你好世界</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">MavLink和PX4</span>
    <ul class="subnav">
                <li class=" current">
                    
    <a class="current" href="./">为AirSim配置PX4</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#px4-setup-for-airsim">PX4 Setup for AirSim</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#supported-hardware">Supported Hardware</a></li>
        
            <li><a class="toctree-l4" href="#setting-up-px4-hardware-in-loop">Setting up PX4 Hardware-in-Loop</a></li>
        
            <li><a class="toctree-l4" href="#setting-up-px4-software-in-loop">Setting up PX4 Software-in-Loop</a></li>
        
            <li><a class="toctree-l4" href="#faq">FAQ</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../px4_sitl/">PX4之软件在环</a>
                </li>
                <li class="">
                    
    <a class="" href="https://youtu.be/1oY8Qu5maQQ">为Pixhawk加载AirSim</a>
                </li>
                <li class="">
                    
    <a class="" href="https://youtu.be/HNWdYrtw3f0">PX4上配置AirSim</a>
                </li>
                <li class="">
                    
    <a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">调试姿态估计</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/Intercepting-MavLink-messages">拦截MavLink的消息</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/Rapid-Descent-on-PX4-drones">让无人机于PX4中快速下降</a>
                </li>
                <li class="">
                    
    <a class="" href="../px4_build/">构建PX4</a>
                </li>
                <li class="">
                    
    <a class="" href="../px4_logging/">PX4/MavLink日志</a>
                </li>
                <li class="">
                    
    <a class="" href="../log_viewer/">查看MavLink日志</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">升级</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../unreal_upgrade/">更新虚幻引擎</a>
                </li>
                <li class="">
                    
    <a class="" href="../upgrade_apis/">更新APIs</a>
                </li>
                <li class="">
                    
    <a class="" href="../upgrade_settings/">更新设置</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">他人贡献的教程</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../reinforcement_learning/">强化学习</a>
                </li>
                <li class="">
                    
    <a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">使用市场中的环境</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/simondlevy/AirSimTensorFlow">简单的碰撞规避算法</a>
                </li>
                <li class="">
                    
    <a class="" href="https://aka.ms/AutonomousDrivingCookbook">在Azure上的自动驾驶</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/hexacopter">建设Hexacopter</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">按路径移动演示</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/Point-Clouds">构建点云</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/Implementing-a-Drone-Survey-script">使用无人机进行测量</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">杂项</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../custom_drone/">真实无人机上的AirSim</a>
                </li>
                <li class="">
                    
    <a class="" href="../cmake_linux/">在Linux上安装cmake</a>
                </li>
                <li class="">
                    
    <a class="" href="../hard_drive/">关于非固体硬盘的建议</a>
                </li>
                <li class="">
                    
    <a class="" href="../pfm/">pfm格式</a>
                </li>
                <li class="">
                    
    <a class="" href="../unreal_proj/">设置虚幻环境</a>
                </li>
                <li class="">
                    
    <a class="" href="../unreal_blocks/">Blocks环境</a>
                </li>
                <li class="">
                    
    <a class="" href="../who_is_using/">谁在使用AirSim</a>
                </li>
                <li class="">
                    
    <a class="" href="../working_with_plugin_contents/">使用UE插件内容</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/Microsoft/AirSim/wiki/technion">方程式赛车的自动驾驶</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Support</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../faq/">FAQ</a>
                </li>
                <li class="">
                    
    <a class="" href="../SUPPORT/">支持</a>
                </li>
                <li class="">
                    
    <a class="" href="../create_issue/">在GitHub上创建Issue</a>
                </li>
                <li class="">
                    
    <a class="" href="../CONTRIBUTING/">贡献</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">AirSim中文文档</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>MavLink和PX4 &raquo;</li>
        
      
    
    <li>为AirSim配置PX4</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/FrendoWu/AirSim-docs-zh/edit/master/docs/px4_setup.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="px4-setup-for-airsim">PX4 Setup for AirSim</h1>
<p>The <a href="http://github.com/px4/firmware">PX4 software stack</a> is an open source very popular flight controller with support for wide variety of boards and sensors as well as built-in capability for higher level tasks such as mission planning. Please visit <a href="http://px4.io">px4.io</a> for more information.</p>
<p><strong>Warning</strong>: While all releases of AirSim are always tested with PX4 to ensure the support, setting up PX4 is not a trivial task. Unless you have at least intermediate level of experience with PX4 stack, we recommend you use <a href="../simple_flight/">simple_flight</a>, which is now a default in AirSim. </p>
<h2 id="supported-hardware">Supported Hardware</h2>
<p>The following Pixhawk hardware has been tested with AirSim:</p>
<ol>
<li><a href="https://3dr.com/support/pixhawk/">3DR Pixhawk v2</a></li>
<li><a href="https://store.3dr.com/products/3dr-pixhawk">3DR Pixhawk mini</a></li>
<li><a href="http://www.banggood.com/Pixhawk-PX4-2_4_8-Flight-Controller-32-Bit-ARM-PX4FMU-PX4IO-Combo-for-Multicopters-p-1040416.html">Pixhawk PX4 2.4.8</a></li>
<li><a href="https://hobbyking.com/en_us/pixfalcon-micro-px4-autopilot.html?___store=en_us">PixFalcon</a></li>
<li><a href="https://www.banggood.com/Pixracer-Autopilot-Xracer-V1_0-Flight-Controller-Mini-PX4-Built-in-Wifi-For-FPV-Racing-RC-Multirotor-p-1056428.html?utm_source=google&amp;utm_medium=cpc_ods&amp;utm_content=starr&amp;utm_campaign=Smlrfpv-ds-FPVracer&amp;gclid=CjwKEAjw9MrIBRCr2LPek5-h8U0SJAD3jfhtbEfqhX4Lu94kPe88Zrr62A5qVgx-wRDBuUulGzHELRoCRVTw_wcB">PixRacer</a></li>
<li><a href="http://www.proficnc.com/">Pixhawk 2.1</a> (using PX4 Flight Stack)</li>
</ol>
<p>The 3DR Pixhawk Mini works out of the box, the others you may need to re-flash with the latest firmware.</p>
<h2 id="setting-up-px4-hardware-in-loop">Setting up PX4 Hardware-in-Loop</h2>
<p>For this you will need one of the supported device listed above. For manual flight you will also need RC + transmitter.</p>
<ol>
<li>Make sure your RC receiver is bound with its RC transmitter. Connect the RC transmitter to the flight controller's RC port. Refer to your RC manual and <a href="https://docs.px4.io/en/getting_started/rc_transmitter_receiver.html">PX4 docs</a> for more information.</li>
<li>Download <a href="http://qgroundcontrol.com/">QGroundControl</a>, launch it and connect your flight controller to the USB port.</li>
<li>Use QGroundControl to flash the latest PX4 Flight Stack.
See also <a href="https://dev.px4.io/starting-initial-config.html">initial firmware setup video</a>.</li>
<li>In QGroundControl, configure your Pixhawk for HIL simulation by selecting the HIL Quadrocopter X airframe.  After PX4 reboots, check that "HIL Quadrocopter X" is indeed selected.</li>
<li>In QGroundControl, go to Radio tab and calibrate (make sure the remote control is on and the receiver is showing the indicator for the binding). </li>
<li>Go to the Flight Mode tab and chose one of the remote control switches as "Mode Channel". Then set (for example) Stabilized and Attitude flight modes for two positions of the switch.</li>
<li>Go to the Tuning section of QGroundControl and set appropriate values. For example, for Fly Sky's FS-TH9X remote control, the following settings give a more realistic feel: Hover Throttle = mid+1 mark, Roll and pitch sensitivity = mid-3 mark, Altitude and position control sensitivity = mid-2 mark.</li>
<li>In <a href="../settings/">AirSim settings</a> file, specify PX4 for your vehicle config like this:</li>
</ol>
<pre><code>{
  &quot;SettingsVersion&quot;: 1.2,
  &quot;SimMode&quot;: &quot;Multirotor&quot;,
  &quot;Vehicles&quot;: {
    &quot;PX4&quot;: {
      &quot;VehicleType&quot;: &quot;PX4Multirotor&quot;
    }
  }
}
</code></pre>

<p>After above setup you should be able to use RC to fly in the AirSim. You can usually arm the vehicle by lowering and bringing two sticks of RC together in-wards. You don't need QGroundControl after the initial setup. Typically the Stabilized (instead of Manual) mode gives better experience for beginners.</p>
<p>You can also control the drone from <a href="../apis/">Python APIs</a>.</p>
<p>See <a href="https://youtu.be/HNWdYrtw3f0">Walkthrough Demo Video</a> and  <a href="https://youtu.be/1oY8Qu5maQQ">Unreal AirSim Setup  Video</a> that shows you all the setup steps in this document.</p>
<h2 id="setting-up-px4-software-in-loop">Setting up PX4 Software-in-Loop</h2>
<p>The PX4 SITL mode doesn't require you to have separate device such as a Pixhawk or Pixracer. This is in fact the recommended way to use PX4 with simulators by PX4 team. However, this is indeed harder to set up. Please see <a href="../px4_sitl/">this dedicated page</a> for setting up PX4 in SITL mode.</p>
<h2 id="faq">FAQ</h2>
<h4 id="drone-doesnt-fly-properly-it-just-goes-crazy">Drone doesn't fly properly, it just goes "crazy".</h4>
<p>There are a few reasons that can cause this. First, make sure your drone doesn't fall down large distance when starting the simulator. This might happen if you have created a custom Unreal environment and Player Start is placed too high above the ground. It seems that when this happens internal calibration in PX4 gets confused. </p>
<p>You should also use QGroundControl and make sure you can arm and takeoff in QGroundControl properly.</p>
<p>Finally, this also can be a machine performance issue in some rare cases, check your <a href="../hard_drive/">hard drive performance</a>.</p>
<h4 id="can-i-use-arducopter-or-other-mavlink-implementations">Can I use Arducopter or other MavLink implementations?</h4>
<p>Our code is tested with the <a href="https://dev.px4.io/">PX4 firmware</a>. We have not tested Arducopter or other mavlink implementations. Some of the flight API's do use the
PX4 custom modes in the MAV_CMD_DO_SET_MODE messages (like PX4_CUSTOM_MAIN_MODE_AUTO)</p>
<h4 id="it-is-not-finding-my-pixhawk-hardware">It is not finding my Pixhawk hardware</h4>
<p>Check your settings.json file for this line "SerialPort":"*,115200".  The asterisk here means "find any 
serial port that looks like a Pixhawk device, but this doesn't always work for all types of Pixhawk hardware.
So on Windows you can find the actual COM port using Device Manager, look under "Ports (COM &amp; LPT), plug the 
device in and see what new COM port shows up.  Let's say you see a new port named "USB Serial Port (COM5)". 
Well, then change the SerialPort setting to this: "SerialPort":"COM5,115200".  </p>
<p>On Linux, the device can be found by running "ls /dev/serial/by-id" if you see a device name listed that looks
like this <code>usb-3D_Robotics_PX4_FMU_v2.x_0-if00</code> then you can use that name to connect, like this:
"SerialPort":"/dev/serial/by-id/usb-3D_Robotics_PX4_FMU_v2.x_0-if00".  Note this long name is actually a symbolic link to the real 
name, if you use "ls -l ..." you can find that symbolic link, it is usually something like "/dev/ttyACM0",
so this will also work "SerialPort":"/dev/ttyACM0,115200".  But that mapping is similar to windows, it is
automatically assigned and can change, whereas the long name will work even if the actual TTY serial device
mapping changes.</p>
<h4 id="warn-commander-takeoff-denied-disarm-and-re-try">WARN  [commander] Takeoff denied, disarm and re-try</h4>
<p>This happens if you try and take off when  PX4 still has not computed the home position.  PX4 will report the home
position once it is happy with the GPS signal, and you will see these messages:</p>
<pre><code>INFO  [commander] home: 47.6414680, -122.1401672, 119.99
INFO  [tone_alarm] home_set
</code></pre>

<p>Up until this point in time, however, the PX4 will reject takeoff commands.</p>
<h4 id="when-i-tell-the-drone-to-do-something-it-always-lands">When I tell the drone to do something it always lands</h4>
<p>For example, you use DroneShell <code>moveToPosition -z -20 -x 50 -y 0</code> which it does, but when it gets to the target location the
drone starts to land.  This is the default behavior of PX4 when offboard mode completes.  To set the drone to hover instead
set this PX4 parameter:</p>
<pre><code>param set COM_OBL_ACT 1
</code></pre>

<h4 id="i-get-message-length-mismatches-errors">I get message length mismatches errors</h4>
<p>You might need to set MAV_PROTO_VER parameter in QGC to "Always use version 1". Please see <a href="https://github.com/Microsoft/AirSim/issues/546">this issue</a> more details.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../px4_sitl/" class="btn btn-neutral float-right" title="PX4之软件在环">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../hello_drone/" class="btn btn-neutral" title="无人机之你好世界"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/FrendoWu/AirSim-docs-zh/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../hello_drone/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../px4_sitl/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
